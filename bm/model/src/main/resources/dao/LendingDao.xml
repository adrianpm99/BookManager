<?xml version="1.0" encoding="UTF-8"?>
<JdbcEntitySetup
 xmlns="http://www.ontimize.com/schema/jdbc"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://www.ontimize.com/schema/jdbc http://www.ontimize.com/schema/jdbc/ontimize-jdbc-dao.xsd"
 catalog="" schema="${mainschema}" table="LENDING"
 datasource="mainDataSource" sqlhandler="dbSQLStatementHandler">
 <DeleteKeys>
  <Column>LENDINGID</Column>
 </DeleteKeys>
 <UpdateKeys>
  <Column>LENDINGID</Column>
 </UpdateKeys>
 <GeneratedKey>lendingid</GeneratedKey>
 
 <Queries>
  <Query id="details">
   <AmbiguousColumns>
    <AmbiguousColumn name="CUSTOMERID_CUSTOMER" prefix="C" databaseName="CUSTOMERID" />
    <AmbiguousColumn name="CUSTOMERID_LENDING" prefix="L" databaseName="CUSTOMERID" />
    <AmbiguousColumn name="COPYID_COPY" prefix="COP" databaseName="COPYID" />
    <AmbiguousColumn name="COPYID_COPYLENDING" prefix="CL" databaseName="COPYID" />
    <AmbiguousColumn name="BOOKID_COPY" prefix="COP" databaseName="BOOKID" />
    <AmbiguousColumn name="BOOKID_BOOK" prefix="B" databaseName="BOOKID" />
    <AmbiguousColumn name="LENDINGID" prefix="L" databaseName="LENDINGID" />
    <AmbiguousColumn name="CL_LENDINGID" prefix="CL" databaseName="LENDINGID" />
   </AmbiguousColumns>
   <Sentence>
   <![CDATA[
     SELECT
      	#COLUMNS#
     FROM
      	LENDING L
     INNER JOIN CUSTOMER C ON
      	L.CUSTOMERID = C.CUSTOMERID
     #WHERE#
   ]]>
   </Sentence>
  </Query>
  <Query id="copiesFromLending">
  	<AmbiguousColumns>
  		<AmbiguousColumn name="COPYID" prefix="COP" databaseName="COPYID" />
    	<AmbiguousColumn name="CL_COPYID_COPYLENDING" prefix="CL" databaseName="COPYID" />
    	
  		<AmbiguousColumn name="LENDINGID" prefix="L" databaseName="LENDINGID" />
    	<AmbiguousColumn name="CL_LENDINGID" prefix="CL" databaseName="LENDINGID" />
    	
    	<AmbiguousColumn name="COP_BOOKID" prefix="COP" databaseName="BOOKID" />
    	<AmbiguousColumn name="BOOKID" prefix="B" databaseName="BOOKID" />
    </AmbiguousColumns>
  	<Sentence>
  		<![CDATA[
     SELECT
     	#COLUMNS#
     FROM
     	LENDING L
     INNER JOIN COPYLENDING CL ON
     	L.LENDINGID = CL.LENDINGID
     INNER JOIN COPY COP ON
     	CL.COPYID = COP.COPYID
     INNER JOIN BOOK B ON 
     	COP.BOOKID = B.BOOKID
     #WHERE#
   ]]>
  	</Sentence>
  </Query>
  <Query id="expiredLending">
   <Sentence>
   <![CDATA[
     SELECT
      #COLUMNS#
     FROM
      LENDING L
      WHERE lendingdeadline < current_date 
     AND lendingreturndate is null
   ]]>
   </Sentence>
  </Query>
 </Queries>

 
</JdbcEntitySetup>